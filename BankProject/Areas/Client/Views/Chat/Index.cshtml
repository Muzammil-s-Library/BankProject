@model List<Contacts>

<div class="chat-container">
    <!-- Contacts Panel -->
    <div class="contacts-panel">
        <div class="contacts-header">
            <h3>Contacts</h3>
            <button class="btn btn-secondary btn-sm" onclick="toggleAddContactForm()">Add Contact</button>
        </div>
        <ul id="contact-list">
            @foreach (var contact in Model)
            {
                <li>
                    <a href="chat?id= @contact.ContactUserId" onclick="startChat('@contact.ContactUserId', '@contact.ContactName')">
                        @contact.ContactName
                    </a>
                </li>
            }
        </ul>
        <form method="post" asp-action="AddContact" asp-controller="Chat">
            <div class="contact-form" id="contact-form" style="display: none;">
                <input type="email" name="email" class="form-control" placeholder="Enter Email" required>
                <input type="text" name="name" class="form-control" placeholder="Enter Name" required>
                <button type="submit" class="btn btn-success w-100 mt-2">Save</button>
            </div>
        </form>

    </div>

    <!-- Chat Window -->
    <div class="chat-window">
        <div class="chat-header">
            <h3 id="chat-header">Select a Contact</h3>
        </div>
        <div id="chat-box" class="chat-box"></div>
        <div class="chat-input">
            <input type="text" id="chat-input" class="form-control" placeholder="Type a message...">
            <button class="btn btn-primary" onclick="sendMessage()">Send</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
<script>
    var connection = new signalR.HubConnectionBuilder().withUrl("/ChatHub").build();

    connection.start().catch(err => console.error(err.toString()));
    function toggleAddContactForm() {
        const form = document.getElementById("contact-form");
        form.style.display = form.style.display === "none" ? "block" : "none";
    }
    function sendMessage() {
        let message = document.getElementById("chat-input").value.trim();
        if (!message) return;

        let urlParams = new URLSearchParams(window.location.search);
        let receiverId = urlParams.get("id"); // Get receiverId from URL

        if (!receiverId) {
            alert("No contact selected.");
            return;
        }

        connection.invoke("SendMessage", receiverId, message)
            .then(() => {
                document.getElementById("chat-box").innerHTML += `<div>You: ${message}</div>`;
                document.getElementById("chat-input").value = ""; // Clear input
            })
            .catch(err => console.error(err.toString()));
    }

    connection.on("ReceiveMessage", (senderId, message) => {
        document.getElementById("chat-box").innerHTML += `<div>Friend: ${message}</div>`;
    });
</script>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f1f1f1;
    }

    .site-navbar {
        background-color: #343a40;
        color: white;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chat-container {
        display: flex;
        margin: auto;
        width: 90%;
        max-width: 1200px;
        height: 70vh;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

   

    /* Contacts Panel */
    .contacts-panel {
        width: 30%;
        background: #e5e5e5;
        display: flex;
        flex-direction: column;
        border-right: 2px solid #ddd;
    }

    .contacts-header {
        background: #25d366;
        color: white;
        padding: 15px;
        text-align: center;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .contacts-panel ul {
        list-style: none;
        padding: 0;
        margin: 0;
        flex-grow: 1;
        overflow-y: auto;
    }

    .contacts-panel ul li {
        padding: 15px;
        cursor: pointer;
        border-bottom: 1px solid #ddd;
        transition: background 0.3s;
    }

    .contacts-panel ul li:hover {
        background: #c8facd;
    }

    .contact-form {
        padding: 15px;
        background: #f8f9fa;
    }

    /* Chat Window */
    .chat-window {
        width: 70%;
        display: flex;
        flex-direction: column;
        background: #f9f9f9;
    }

    .chat-header {
        background: #007bff;
        color: white;
        padding: 15px;
        text-align: center;
        font-weight: bold;
    }

    .chat-box {
        flex-grow: 1;
        overflow-y: auto;
        padding: 15px;
        display: flex;
        flex-direction: column;
    }

    .chat-box div {
        margin: 10px;
        padding: 10px;
        border-radius: 10px;
        max-width: 70%;
    }

    .chat-box .sender {
        align-self: flex-end;
        background: #007bff;
        color: white;
    }

    .chat-box .receiver {
        align-self: flex-start;
        background: #ddd;
    }

    .chat-input {
        display: flex;
        padding: 15px;
        background: white;
    }

    .chat-input input {
        flex-grow: 1;
        margin-right: 10px;
    }

    footer {
        display: none !important;
    }
</style>
